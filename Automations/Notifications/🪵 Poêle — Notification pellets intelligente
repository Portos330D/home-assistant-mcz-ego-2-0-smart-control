alias: ü™µ Po√™le ‚Äî Notification pellets intelligente
description: Notif unique par seuil 30 / 15 / 5 %
triggers:
  - entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
    below: 30
    trigger: numeric_state
  - entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
    below: 15
    trigger: numeric_state
  - entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
    below: 5
    trigger: numeric_state
actions:
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
            below: 5
          - condition: state
            entity_id: input_boolean.notif_pellet_5
            state: "off"
        sequence:
          - data:
              message: |
                üö® Pellet critique !
                Niveau : {{ niveau }} %
            action: telegram_bot.send_message
          - target:
              entity_id: input_boolean.notif_pellet_5
            action: input_boolean.turn_on
      - conditions:
          - condition: numeric_state
            entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
            below: 15
          - condition: state
            entity_id: input_boolean.notif_pellet_15
            state: "off"
        sequence:
          - data:
              message: |
                ‚ö†Ô∏è Pellet faible
                Niveau : {{ niveau }} %
            action: telegram_bot.send_message
          - target:
              entity_id: input_boolean.notif_pellet_15
            action: input_boolean.turn_on
      - conditions:
          - condition: numeric_state
            entity_id: sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige
            below: 30
          - condition: state
            entity_id: input_boolean.notif_pellet_30
            state: "off"
        sequence:
          - data:
              message: |
                ‚ÑπÔ∏è Pellet √† surveiller
                Niveau : {{ niveau }} %
            action: telegram_bot.send_message
          - target:
              entity_id: input_boolean.notif_pellet_30
            action: input_boolean.turn_on
mode: single
variables:
  niveau: |
    {{ states('sensor.niveau_pellet_vl53l0x_niveau_pellets_corrige')
       | float(0)
       | round(1)
       | string
       | replace('.', ',') }}
